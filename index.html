<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <base href="./" />
    <link rel="icon" href="assets/icons/redcap.png" />
    <title>Forest Pathways – Logic Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .overlay {
        opacity: 1;
        transition: opacity 200ms ease;
      }

      .overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }

      .board-shake {
        animation: board-shake 300ms ease;
      }

      .board-glow-success {
        animation: board-glow-success 600ms ease;
      }

      .board-glow-error {
        animation: board-glow-error 600ms ease;
      }

      @keyframes board-shake {
        0% { transform: translateX(0); }
        20% { transform: translateX(-6px); }
        40% { transform: translateX(6px); }
        60% { transform: translateX(-4px); }
        80% { transform: translateX(4px); }
        100% { transform: translateX(0); }
      }

      @keyframes board-glow-success {
        0% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); }
        30% { box-shadow: 0 0 24px rgba(16, 185, 129, 0.45); }
        100% { box-shadow: 0 0 0 rgba(16, 185, 129, 0); }
      }

      @keyframes board-glow-error {
        0% { box-shadow: 0 0 0 rgba(248, 113, 113, 0); }
        30% { box-shadow: 0 0 24px rgba(248, 113, 113, 0.45); }
        100% { box-shadow: 0 0 0 rgba(248, 113, 113, 0); }
      }

      .hero-pattern {
        background-color: #0b1120;
        background-image: radial-gradient(1200px 800px at 15% 10%, rgba(14, 116, 144, 0.18), transparent 60%),
          radial-gradient(900px 700px at 85% 25%, rgba(30, 64, 175, 0.18), transparent 55%),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='72' height='72' viewBox='0 0 72 72' fill='none' stroke='%2394a3b8' stroke-width='1' stroke-opacity='0.08'%3E%3Cpath d='M-12 12L12 -12M0 24L24 0M12 36L36 12M24 48L48 24M36 60L60 36M48 72L72 48M60 84L84 60'/%3E%3C/svg%3E");
        background-size: auto, auto, 144px 144px;
        background-attachment: fixed;
      }

      .custom-scrollbar::-webkit-scrollbar {
        height: 4px;
        width: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.3);
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(148, 163, 184, 0.2);
        border-radius: 10px;
      }

      html {
        height: 100%;
        overflow: hidden;
      }
      body {
        box-sizing: border-box;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        margin: 0;
        /* Safe areas: Padding liegt INNERHALB der Höhe (border-box), Footer bleibt sichtbar */
        padding-top: env(safe-area-inset-top, 0);
        padding-bottom: env(safe-area-inset-bottom, 0);
        padding-left: env(safe-area-inset-left, 0);
        padding-right: env(safe-area-inset-right, 0);
        height: 100vh;
        height: 100dvh;
        overflow: hidden;
      }
      /* Handy: kleine Viewport-Höhe, damit Footer garantiert im sichtbaren Bereich liegt */
      @media (pointer: coarse) {
        body { height: 100svh; }
      }
      /* Kleine Viewports: 100svh, damit Footer garantiert im sichtbaren Bereich liegt */
      @media (max-height: 50rem) {
        body { height: 100svh; min-height: 100svh; }
      }
      /* Footer: zusätzlicher Abstand über Browser-Leiste / Home-Indicator */
      .footer-safe {
        padding-bottom: max(0.75rem, env(safe-area-inset-bottom, 0px));
      }
      /* Main darf schrumpfen, damit Header + Main + Footer in die Höhe passen */
      .main-fill {
        min-height: 0;
      }
      /* Tile-Leiste: max. Höhe, bei vielen Tiles oder kleinem Screen vertikal scrollbar */
      #tileList {
        max-height: min(5rem, 20vh);
        overflow-y: auto;
      }
      /* Sehr kleine Viewports: Tile-Cards etwas kleiner für mehr Platz */
      @media (max-height: 30rem) {
        .tile-card {
          height: 3rem;
          min-width: 4rem;
          width: 4rem;
        }
      }

      /* Start overlay: controls hint by device (touch vs pointer) */
      .overlay-controls-touch { display: none; }
      .overlay-controls-pointer { display: block; }
      @media (pointer: coarse) {
        .overlay-controls-touch { display: block; }
        .overlay-controls-pointer { display: none; }
      }
    </style>
  </head>
  <body class="hero-pattern min-h-screen overflow-hidden bg-slate-950 text-slate-100 touch-none box-border">
    <div class="flex h-full w-full flex-col overflow-hidden">
      <!-- HEADER -->
      <header class="z-10 flex flex-shrink-0 items-center justify-between border-b border-slate-800/50 bg-slate-900/40 p-3 px-4 backdrop-blur-md">
        <div class="flex items-center gap-3">
          <img src="assets/Logo.webp" alt="Logo" class="h-6 sm:h-8 object-contain" />
          <div class="h-4 w-px bg-slate-700/50 hidden sm:block"></div>
          <div class="hidden flex-col sm:flex">
             <span id="difficultyBadge" class="text-[9px] font-bold uppercase tracking-widest text-emerald-400"></span>
             <span id="modeLabel" class="text-[9px] font-medium uppercase tracking-widest text-slate-400"></span>
          </div>
        </div>

        <div class="flex flex-1 max-w-xs mx-4">
           <select
            id="challengeSelect"
            class="w-full rounded-xl border border-slate-700 bg-slate-950/50 px-3 py-1.5 text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-emerald-500/50"
          ></select>
        </div>

        <div class="flex items-center gap-1 sm:gap-2">
          <button id="resetBtn" class="flex h-8 w-8 items-center justify-center rounded-full text-slate-400 transition hover:bg-slate-800 hover:text-rose-400 active:scale-90" title="Reset">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></svg>
          </button>
          <button id="hintBtn" class="flex h-8 w-8 items-center justify-center rounded-full text-slate-400 transition hover:bg-slate-800 hover:text-amber-400 active:scale-90" title="Hint">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10" /><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" /><line x1="12" y1="17" x2="12.01" y2="17" /></svg>
          </button>
          <button id="musicMuteBtn" class="flex h-8 w-8 items-center justify-center rounded-full text-slate-400 transition hover:bg-slate-800 hover:text-slate-100 active:scale-90" title="Music on/off">
            <svg id="musicMuteOnIcon" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path></svg>
            <svg id="musicMuteOffIcon" class="h-4 w-4 hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
          </button>
        </div>
      </header>

      <!-- MAIN AREA -->
      <main class="main-fill relative flex flex-1 flex-col overflow-hidden items-center justify-center p-2">
        <div class="game-frame relative flex min-h-0 w-full flex-1 items-center justify-center overflow-hidden rounded-2xl">
          <canvas id="board" width="640" height="640" aria-label="Redcape Board" class="block h-auto w-full max-h-full object-contain"></canvas>

          <!-- Rotate + Check als Overlay auf dem Spielfeld -->
          <div class="absolute bottom-3 left-1/2 z-10 flex -translate-x-1/2 items-center gap-2 pointer-events-none">
            <div class="pointer-events-auto flex items-center gap-2 rounded-full border border-slate-700/80 bg-slate-900/90 px-2 py-1.5 shadow-xl backdrop-blur-sm">
              <button id="rotateBtn" class="flex h-9 items-center gap-2 rounded-full bg-slate-800/80 px-3 text-xs font-bold text-slate-100 transition hover:bg-slate-700 active:scale-95" title="Rotate">
                <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8" /><path d="M21 3v5h-5" /></svg>
                <span>Rotate</span>
              </button>
              <button id="checkBtn" class="flex h-9 items-center gap-2 rounded-full bg-emerald-600 px-4 text-xs font-bold text-white transition hover:bg-emerald-500 active:scale-95 shadow-lg shadow-emerald-950/40" type="button" title="Check">
                <svg class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5" /></svg>
                <span>CHECK</span>
              </button>
            </div>
          </div>

          <!-- Overlay Messages -->
          <div id="overlay" class="overlay absolute inset-0 z-20 grid place-items-center bg-slate-950/80 p-4">
            <div class="max-w-xs rounded-2xl border border-slate-700 bg-slate-900 p-6 text-center shadow-2xl">
              <h2 id="overlayTitle" class="text-xl font-semibold text-slate-100">Ready?</h2>
              <p id="overlayText" class="mt-2 text-sm text-slate-300">Choose a challenge and start.</p>
              <div class="mt-4 pt-4 border-t border-slate-700/80 text-left">
                <p class="text-[10px] font-semibold uppercase tracking-widest text-slate-500 mb-1.5">Controls</p>
                <p class="overlay-controls-touch text-xs text-slate-400">Tap a tile to select, drag onto the board to place. Use <strong class="text-slate-300">Rotate</strong> to turn. Drag off the board to remove.</p>
                <p class="overlay-controls-pointer text-xs text-slate-400">Click a tile to select, drag onto the board to place. Use <strong class="text-slate-300">Rotate</strong> to turn. Drag off the board to remove.</p>
              </div>
              <button
                id="overlayBtn"
                class="mt-6 w-full rounded-full bg-emerald-600 px-6 py-3 text-sm font-bold text-white transition hover:bg-emerald-500 active:scale-95 shadow-lg shadow-emerald-950/40"
                type="button"
              >
                Play now
              </button>
            </div>
          </div>
        </div>
        <div id="statusContainer" class="flex flex-shrink-0 items-center justify-center gap-2 mt-2 min-w-0">
          <div class="h-1.5 w-1.5 rounded-full bg-emerald-500 animate-pulse flex-shrink-0"></div>
          <p id="statusText" class="truncate text-[10px] font-bold uppercase tracking-widest text-slate-500">Ready.</p>
        </div>
      </main>

      <!-- FOOTER: nur Tile-Leiste -->
      <footer class="footer-safe z-10 flex flex-shrink-0 flex-col bg-slate-900/60 p-3 pt-3 backdrop-blur-xl border-t border-slate-800/50">
        <div id="tileList" class="custom-scrollbar flex min-h-[3.5rem] flex-wrap items-center justify-center gap-2 overflow-x-auto overflow-y-auto px-2 py-1">
          <!-- Tiles will be injected here -->
        </div>
      </footer>

      <!-- Help Overlay (Minimal) -->
      <div id="helpOverlay" class="overlay hidden absolute inset-0 z-30 grid place-items-center bg-slate-950/90 p-4 backdrop-blur-sm">
        <div class="max-w-lg w-full rounded-2xl border border-slate-700 bg-slate-900 p-6 shadow-2xl max-h-[80vh] overflow-y-auto custom-scrollbar">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-semibold text-slate-100">How to Play</h2>
            <button id="closeHelpBtn" class="p-2 text-slate-500 hover:text-slate-100 transition"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></svg></button>
          </div>
          <div class="space-y-4 text-xs sm:text-sm text-slate-400 leading-relaxed">
            <p>Connect pathways from Red Riding Hood to the house.</p>
            <ul class="list-disc ml-5 space-y-1">
              <li><strong class="text-slate-200">Drag</strong> tiles to place them.</li>
              <li><strong class="text-slate-200">Tap</strong> to select, use <strong class="text-slate-200">Rotate</strong> button to turn.</li>
              <li><strong class="text-slate-200">With Wolf:</strong> Create two separate paths. Wolf's path must be shorter.</li>
              <li><strong class="text-slate-200">Outside:</strong> Drag a tile off the board to remove it.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="data/challenges.inline.js"></script>
    <script src="scripts/logic-core.js"></script>
    <script src="scripts/solver-engine.js"></script>
    <script src="app.js" defer></script>
  </body>
</html>
